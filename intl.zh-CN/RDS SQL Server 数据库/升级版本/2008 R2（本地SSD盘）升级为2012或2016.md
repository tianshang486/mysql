# 2008 R2（本地SSD盘）升级为2012或2016

您可以将SQL Server 2008 R2（本地SSD盘）实例的引擎从低版本升级到高版本，并且可以在升级时更换可用区。

阿里云自2019年7月9日起对新购的RDS SQL Server 2008 R2实例停止提供SQL Server补丁更新服务，详情请参见[补充服务协议]()。建议您尽快升级版本。

不同版本的功能差异请参见[各版本的功能差异](/intl.zh-CN/RDS SQL Server 数据库/快速入门/各版本的功能差异.md)。

## 费用说明

升级版本的费用请参见[变配](/intl.zh-CN/云数据库 RDS 价格/变配.md)。

## 影响

升级完成后，切换停机时间依实例大小不同有变化，一般20分钟内完成，建议选择维护时间段切换，并请确保应用具备重连机制。

## 前提条件

-   实例为SQL Server 2008 R2（本地SSD盘）。
-   实例的存储空间总量不能低于20GB。
-   实例未开启[TDE]()功能。

    **说明：** 已开启TDE的需要关闭所有数据库的TDE功能，然后提交工单申请关闭实例级别的TDE功能。


## 注意事项

-   版本升级后无法回退到低版本。

    **警告：** 由于升级后无法回退，建议您升级前先使用[高版本临时实例](#section_hw0_nlc_1uk)测试兼容性等问题。

-   仅支持从SQL Server 2008 R2（本地SSD盘）升级到如下版本：
    -   SQL Server 2012企业版
    -   SQL Server 2016标准版
    -   SQL Server 2016企业版
-   开启了SSL的实例可以直接升级，升级成功后高版本实例数据库连接地址不变，但是SSL保护默认关闭，需要重新[设置SSL加密]()。
-   SQL Server 2008 R2（本地SSD盘）升级到SQL Server 2012企业版或2016企业版会保留TDE功能，升级到SQL Server 2016标准版则没有TDE功能。

## 操作步骤

1.  登录[RDS管理控制台](https://rds.console.aliyun.com/)。
2.  在左侧单击**实例列表**，然后在上方选择实例所在地域。

    ![选择地域](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3074469951/p36543.png)

3.  找到目标实例，单击实例ID。
4.  在**基本信息**页面，单击**升级版本**，在弹出的对话框中单击**确定**。

    ![升级版本新](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4776237061/p188639.png)

    ![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7303729951/p53145.png)

5.  在**升级引擎版本**页面修改配置，说明如下。

    |参数名称|说明|
    |----|--|
    |**升级到版本**|选择不同的目标版本，对应的**系列**、**存储类型**、**规格**选项也会变化。|
    |**系列**|**高可用版**：一主一备的经典高可用架构，各方面表现均衡。|
    |**存储类型**|    -   **SSD云盘**：基于分布式存储架构的弹性块存储设备。将数据存储于SSD云盘，即实现了计算与存储分离。
    -   **ESSD云盘**：增强型SSD云盘，是阿里云全新推出的超高性能云盘产品。ESSD云盘基于新一代分布式块存储架构，结合25GE网络和RDMA技术，为您提供单盘高达100万的随机读写能力和更低的单路时延能力。 |
    |**可用区**|目标可用区，支持选择多可用区。|
    |**规格**|每种规格都有对应的CPU核数、内存、最大连接数和最大IOPS。详情请参见[主实例规格列表](/intl.zh-CN/云数据库 RDS 简介/产品规格/主实例规格列表.md)。|
    |**网络类型**|无法选择**经典网络**，必须指定专有网络信息：     -   原实例为经典网络：可以修改专有网络和交换机。
    -   原实例为专有网络或混访模式：不可以修改专有网络，可以修改交换机。可选择的交换机由**可用区**和专有网络决定。 |
    |**交换机**|目标交换机。升级至多可用区时需要选择多个目标交换机。 **说明：**

    -   如果选择的是默认VPC，目标交换机支持默认交换机和非默认交换机。
    -   如果选择的是非默认VPC，目标交换机只支持非默认交换机。 |
    |**切换时间**|    -   **数据迁移结束后立即切换**：立刻进行迁移并切换。
    -   **可维护时间内进行切换**：立刻进行迁移并在可维护时间段内进行切换。 |

    ![升级配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8303729951/p41116.png)

6.  勾选服务条款，单击**确认变更**。

## 连接地址变更规则

升级后新实例都处于专有网络，根据原实例的网络类型，新实例的数据库连接地址变更规则如下。

|原实例网络类型|变更规则|
|-------|----|
|经典网络|新实例为混访模式： -   经典网络连接地址为原实例的网络连接，无过期时间。
-   根据升级时选择的专有网络信息生成一个专有网络连接地址。 |
|专有网络|根据升级时选择的专有网络信息生成一个专有网络连接地址，替换原实例的专有网络连接地址。|
|混访模式|新实例仍然为混访模式，且专有网络和经典网络的连接地址不变，经典网络连接地址的过期时间与之前保持一致。|

## 创建高版本临时实例

高版本临时实例主要用于升级实例版本前测试兼容性等问题。

**说明：** 只有未开启TDE和SSL的SQL Server 2008 R2实例才能创建高版本临时实例。

1.  登录[RDS管理控制台](https://rds.console.aliyun.com/)。
2.  在左侧单击**实例列表**，然后在上方选择实例所在地域。

    ![选择地域](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3074469951/p36543.png)

3.  找到目标实例，单击实例ID。
4.  在左侧导航栏选择**备份恢复**。
5.  在临时实例页签选择克隆数据的时间点，然后单击**创建高版本临时实例**。

    ![选择高版本临时实例](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8303729951/p46604.png)

6.  设置以下参数。

    |参数|说明|
    |--|--|
    |**可用区**|当前可用于创建高版本临时实例的可用区。|
    |**升级到版本**|目标版本，可选择的版本如下：     -   2016标准版
    -   2016企业版
    -   2012企业版 |
    |**VPC**|专有网络，建议与需要连接的ECS实例一致，否则它们无法通过内网互通。|
    |**交换机**|专有网络下的交换机。|

    **说明：** 高版本临时实例规格和存储类型都有默认配置，实例存活时间是7天，之后会自动释放。

    ![高版本临时实例](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8303729951/p46602.png)

7.  单击**确定**。

