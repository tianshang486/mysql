# 通过临时实例恢复SQL Server数据

数据恢复功能可以最大程度地减少数据库误操作造成的损失，您可以通过临时实例来恢复数据。

创建临时实例并不影响当前的生产实例，而是提供一个临时实例供数据访问。您可以先将数据恢复到临时实例，验证无误后再回迁到主实例，减少数据恢复对业务造成的冲击。

## 前提条件

-   本功能适用于以下RDS SQL Server实例：
    -   SQL Server 2012企业版基础系列
    -   SQL Server 2012 Web版
    -   SQL Server 2016 Web版
    -   SQL Server 2008 R2（本地SSD盘）
-   实例已有数据备份，如需按时间点恢复还需要相应的日志备份。

## 注意事项

-   临时实例会继承备份文件的账号和密码。
-   临时实例的网络类型是经典网络。
-   同一时间仅可生成一个临时实例。如果要创建新的临时实例，需先删除已存在的临时实例。
-   临时实例不收取费用，但创建成功后，仅在48小时内有效，之后会自动释放。

## 操作步骤

1.  登录[RDS管理控制台](https://rds.console.aliyun.com/)。
2.  在左侧单击**实例列表**，然后在上方选择实例所在地域。

    ![选择地域](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3074469951/p36543.png)

3.  找到目标实例，单击实例ID。
4.  在左侧菜单栏中单击**备份恢复**。
5.  选择**临时实例**标签页。
6.  选择离目标时间最近的时间段，实例将恢复到设定时间点之前最后备份的时间，单击**创建临时实例**。
7.  在弹出的确认框中单击**确定**，创建临时实例。
8.  临时实例创建完成后，进入RDS实例列表页面。
9.  单击主实例的ID。
10. 单击页面右上角的**导入数据库**，进入[数据传输（DTS）](http://dts.console.aliyun.com/)控制台。
11. 选择左侧导航栏中的**数据迁移**。
12. 单击**创建迁移任务**，输入任务名称、源数据库信息和目标数据库信息。

    参数说明：

    -   任务名称：默认情况下，DTS为每个任务自动生成一个任务名称，您可以修改这个名称，为任务配置一个具备业务意义的名称，便于后续的任务识别。
    -   源库信息：
        -   实例类型：数据库的实例类型，选择**RDS实例**。
        -   实例地区：选择与主实例相同的地域。
        -   RDS实例ID：单击下拉菜单，选择临时实例的ID。
        -   数据库账号：与主实例账号一致，且该账号必须具有对所有要迁移数据的读/写权限。
        -   数据库密码：与主实例账号的密码一致。
    -   目标库信息：
        -   实例类型：默认为RDS实例。
        -   实例地区：主实例所在地域。
        -   RDS实例ID：目标RDS实例的ID。单击下拉菜单选择临时实例所对应的主实例ID。
        -   数据库账号：主实例账号，该账号必须具有对所有要迁移数据的读/写权限。
        -   数据库密码：主实例账号的密码。
13. 单击**授权白名单并进入下一步**进入迁移类型及列表页面。
14. 选择迁移类型，并在迁移对象栏中选择要迁移的对象，单击****\>****将要迁移的对象放入已选择对象栏中，如下图所示。如果要修改迁移对象在目标数据库上的名字，可以在已选择对象中，将鼠标放在需要修改的数据库上面，即会显示出**编辑**按钮，如下图所示。

    ![](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/26207/cn_zh/1496827601510/%E9%80%89%E6%8B%A9%E8%BF%81%E7%A7%BB%E5%AF%B9%E8%B1%A1.png)

15. 单击**预检查并启动**。
16. 此步骤以预检查不通过为例。如果预检查通过，请直接跳转至步骤18。

    若系统显示预检查失败结果，单击检测结果为**失败**后的![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8013729951/p39847.png)，查看失败详细信息，如下图所示。根据失败原因修复后，可在数据**迁移任务列表**中选择该任务，并重新进行预检查。

    ![查看预检结果](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8013729951/p3951.png)

17. 错误排查完毕后，在迁移任务列表页面，选择新创建的迁移任务，单击**启动**，如下图所示。

    ![](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/26207/cn_zh/1496829072181/rds_newuser_image_025.png)

18. 若系统显示预检查通过信息，单击**确定**。
19. 在购买配置确认页面，确认配置信息并勾选**《数据传输（按量付费）服务条款》**，单击**立即购买并启动**。

## 相关API

|API|描述|
|---|--|
|[t8154.md\#](/intl.zh-CN/API 参考/恢复/创建临时实例.md)|创建临时实例|

