# 临时混访方案（同时保留经典网络和专有网络地址）

为满足日益增多的网络迁移需求，RDS新增了网络混访功能，可实现在无访问中断的情况下将经典网络平滑迁移到VPC上。

## 背景信息

以往将RDS实例从经典网络迁移到VPC时，经典网络的内网地址会变为VPC的内网地址（连接字符串没有变化，背后的IP地址有变化），会造成1次30秒内的闪断，而且经典网络中的ECS将不能再通过内网访问该RDS实例，为了能够平滑迁移网络，RDS新增了网络混访功能。

混访是指RDS实例可以同时被经典网络和专有网络中的ECS访问。在混访期间，RDS实例会保留原经典网络的内网地址并新增一个VPC下的内网地址，迁移网络时不会出现闪断。

基于安全性及性能的考虑，我们推荐您仅使用VPC，因此混访期有一定的期限，原经典网络的内网地址在保留时间到期后会被自动释放，应用将无法通过经典网络的内网地址访问数据库。为避免对业务造成影响，您需要在混访期中将VPC下的内网地址配置到您所有的应用中，以实现平滑的网络迁移。

例如，某一公司要将经典网络迁移至VPC时，若选用混访的迁移方式，在混访期内，一部分应用通过VPC访问数据库，一部分应用仍通过原经典网络的内网地址访问数据库，等所有应用都可以通过VPC访问数据库时，就可以将原经典网络的内网地址释放掉，如下图所示。

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0377559951/p4743.png)

## 功能限制

在混访期间，有如下功能限制：

-   不支持切换成经典网络。
-   不支持迁移可用区。

## 前提条件

-   实例的网络类型是经典网络。

-   实例所在可用区已有可用的VPC和交换机。关于创建VPC和交换机的操作，请参见[管理专有网络](/intl.zh-CN/专有网络和交换机/管理专有网络/创建专有网络.md)。


## 从经典网络迁移至VPC

1.  登录[RDS管理控制台](https://rds.console.aliyun.com/)。
2.  在左侧单击**实例列表**，然后在上方选择实例所在地域。

    ![选择地域](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3074469951/p36543.png)

3.  找到目标实例，单击实例ID。
4.  在左侧导航栏中单击**数据库连接**。
5.  单击**切换为专有网络**。
6.  在弹出的对话框中，选择VPC和交换机，以及是否保留经典网络地址。
    -   选择VPC。建议选择您的ECS实例所在的VPC，否则ECS实例与RDS实例无法通过内网互通（除非在两个VPC之间创建[云企业网](https://www.alibabacloud.com/help/zh/doc-detail/64648.htm)或[VPN网关](/intl.zh-CN/用户指南/配置IPsec-VPN/建立VPC到VPC的连接.md)）。
    -   选择交换机。如果选择的VPC中没有交换机（如下图），请创建与实例在同一可用区的交换机。具体操作请参见[管理交换机](/intl.zh-CN/专有网络和交换机/管理交换机/创建交换机.md)。

        ![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0377559951/p21237.png)

    -   选择是否勾选**保留经典网络**，具体说明如下表所述。

        |操作|说明|
        |--|--|
        |不勾选|不保留经典网络地址，原经典网络地址变为VPC地址。

如果不保留经典网络地址，则切换网络类型时，RDS实例会发生一次30秒的闪断，而且经典网络的ECS对该RDS实例的内网访问会立即断开。|
        |勾选|保留经典网络地址，同时生成一个新的VPC地址（如下图）。表示使用混访模式，即RDS可以同时被经典网络和VPC的ECS通过内网访问。

如果保留经典网络地址，则切换网络类型时，RDS实例不会发生闪断，而且经典网络的ECS对该RDS实例的内网访问也不会断开，直到经典网络地址到期才断开。

在经典网络地址到期前，请将VPC地址配置到VPC的ECS中，以实现业务平滑迁移到VPC。 |

7.  将ECS实例内网IP地址添加到RDS实例的白名单（如下图），使得ECS实例可以通过内网访问RDS。

    ![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3603729951/p21650.png)

8.  -   如果选择了保留经典网络地址，请在经典网络地址到期前，将RDS的VPC地址配置到ECS中。
-   如果选择了不保留经典网络地址，那么切换网络类型后，经典网络的ECS对该RDS实例的内网访问会立即断开。请立刻将RDS的VPC地址配置到ECS中。
    **说明：** 如果要使经典网络中的ECS通过内网连接到VPC的RDS，您可以使用[ClassicLink](/intl.zh-CN/VPC与外部网络连接/ClassicLink/ClassicLink概述.md)，或者将ECS切换到VPC网络。


## 修改原经典网络内网地址的过期时间

在混访期间，您可以根据需求随时调整保留原经典网络的时间，过期时间会从变更日期重新开始计时。例如，原经典网络的内网地址会在2017年8月18日过期，但您在2017年8月15日将过期时间变更为“14天后”，则原经典网络的内网地址将会在2017年8月29日被释放。

修改过期时间的操作步骤如下所示：

1.  登录[RDS 管理控制台](https://rds.console.aliyun.com/)。
2.  在左侧单击**实例列表**，然后在上方选择实例所在地域。

    ![选择地域](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3074469951/p36543.png)

3.  找到目标实例，单击实例ID。
4.  在左侧导航栏中单击**数据库连接**。
5.  在实例连接页签，单击**修改过期时间**，如下图所示。

    ![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1377559951/p4748.png)

6.  在修改过期时间的确认页面，选择过期时间，单击**确定**。

