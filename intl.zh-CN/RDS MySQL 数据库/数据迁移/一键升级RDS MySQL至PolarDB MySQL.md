# 一键升级RDS MySQL至PolarDB MySQL

PolarDB支持将RDS MySQL一键升级至PolarDB MySQL，升级后PolarDB集群包含源RDS实例的账号、数据库、IP白名单和必要的参数。

-   源RDS实例版本需为RDS MySQL 5.6或5.7高可用版，且存储类型为本地SSD盘。
-   -   针对RDS MySQL 5.6，内核小版本需为20190130或以上版本。
-   针对RDS MySQL 5.7，内核小版本需为20200331或以上版本。
    **说明：** 您可以执行`show variables like '%rds_release_date%';`命令查看RDS的内核小版本。关于如何升级内核小版本，请参见[升级内核小版本](/intl.zh-CN/RDS MySQL 数据库/升级版本/升级内核小版本.md)。

-   源RDS实例未开启[TDE](/intl.zh-CN/RDS MySQL 数据库/数据安全/加密/设置透明数据加密TDE.md)和[SSL](/intl.zh-CN/RDS MySQL 数据库/数据安全/加密/设置SSL加密.md)。
-   源RDS实例的表存储引擎为InnoDB。
-   如果RDS处于高安全模式（数据库代理模式），需要创建有高权限账号（请参见[创建高权限账号](/intl.zh-CN/RDS MySQL 数据库/快速入门/创建数据库和账号.md)），或者切换到高性能模式（参见[【重要】RDS网络链路升级说明](/intl.zh-CN/活动与通知/【重要】RDS网络链路升级说明.md)），才能进行一键升级。

    ![查看数据库模式](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8003729951/p54653.png)


PolarDB是阿里云自研的下一代关系型云数据库，主要优势如下：

-   存储容量高：最高可达100 TB。
-   性能高：最高可以提升至MySQL的6倍。
-   Serverless存储：存储容量无需提前购买，自动扩缩容，按使用量计费。
-   临时升配：临时升级规格，轻松应对短期的业务高峰。

**说明：** 更多详情，请参见[产品优势](/intl.zh-CN/产品简介/产品优势.md)。

一键升级功能可以将RDS MySQL一键升级为PolarDB MySQL，升级后PolarDB集群包含源RDS实例的账号、数据库、IP白名单和必要的参数。一键升级的主要优势如下：

-   迁移完全免费。
-   迁移过程数据0丢失。
-   支持增量迁移，停机时间小于10分钟。
-   支持回滚，迁移失败可以在10分钟内恢复。
-   支持带地址切换，可以在不修改应用程序的连接配置情况下切到PolarDB。

## 功能限制

-   暂不支持跨地域迁移。
-   迁移期间不允许对源RDS实例执行参数设置的操作。

## 费用

从RDS迁移到PolarDB操作完全免费，您只需承担购买PolarDB集群的费用，详情请参见[规格与定价](/intl.zh-CN/产品定价/规格与定价.md)。

## 迁移流程介绍

|步骤|说明|
|--|--|
|1、[从RDS迁移](#section_s4t_zsn_13b)|本操作将创建一个与源RDS实例数据相同的PolarDB集群，源RDS实例的增量数据会实时同步到该PolarDB集群。|
|2、[迁移切换](#section_jdh_0d3_zjz)|-   在执行迁移切换时，您可以选择带连接切换，系统会自动交换RDS和PolarDB上的连接地址（PolarDB集群上需具备对应的连接地址，例如经典网络或公网地址），您无需在应用程序端修改任何配置即可自动连接到PolarDB。
-   执行本操作后，源RDS实例为只读状态，PolarDB集群为可读可写状态，同时会将PolarDB集群的新增数据同步到源RDS实例。

**说明：** 迁移切换完成后，如果您发现数据存在异常等问题，可以执行[迁移回滚](#section_hw4_hy4_13b)，快速恢复至迁移前的状态。 |
|3、[完成迁移](#section_3ds_ojf_lmm)|-   您可以观察一段时间后确认业务运行正常，再执行本操作（需要在7天内完成）。
-   执行本操作后，PolarDB集群和源RDS实例间的数据同步关系将中断，此时RDS为可读可写状态。 |

## 步骤一：从RDS迁移

本操作将创建一个与源RDS实例数据相同的PolarDB集群，源RDS实例的增量数据会实时同步到该PolarDB集群。

1.  登录[PolarDB控制台](https://polardb.console.aliyun.com/)。

2.  在控制台左上角，选择集群所在地域。

3.  单击**创建新集群**。

    **说明：** 您也可以登录[RDS管理控制台](https://rds.console.aliyun.com/)，找到并单击实例ID，然后单击右上角的**升级为POLARDB**，按照下述步骤完成新集群的创建。

4.  选择**商品类型**为**包年包月**或**按量付费**。

    -   **包年包月**：在创建集群时支付计算节点的费用，而存储空间会根据实际数据量按小时计费，并从账户中按小时扣除。
    -   **按量付费**：无需预先支付费用，计算节点和存储空间（根据实际数据量）均按小时计费，并从账户中按小时扣除。
5.  设置如下参数。

    |参数|说明|
    |--|--|
    |**地域**|选择源RDS MySQL实例所在地域。 **说明：** 新建的PolarDB集群也在此地域。 |
    |**创建方式**|选择**从RDS迁移**。 即从RDS实例克隆一个PolarDB集群，同时保持数据同步。默认开启新集群的Binlog。|
    |**源RDS引擎**|源RDS实例的引擎类型，固定为**MySQL**，不可变更。|
    |**源RDS版本**|源RDS实例的版本，您可以选择**5.6**或**5.7**。|
    |**源RDS实例**|选择源RDS实例，不包括只读实例。|
    |**主可用区**|可用区是地域中的一个独立物理区域，不同可用区之间没有实质性区别。

您可以选择将PolarDB集群与ECS创建在同一可用区或不同的可用区。

您只需要选择主可用区，系统会自动选择备可用区。 |
    |**网络类型**|PolarDB集群的网络类型，不可变更。|
    |**VPC网络****VPC交换机**

|PolarDB集群所属的VPC和虚拟交换机。请确保PolarDB集群与需要连接的ECS创建于同一个VPC，否则它们无法通过内网互通，无法发挥最佳性能。|
    |**兼容性**|PolarDB集群的数据库引擎版本，默认与源RDS引擎版本保持一致，不可变更。|
    |**系列**|固定为**集群版（2-16个节点）（默认推荐）**，无需选择。|
    |**节点规格**|按需选择，建议不低于源RDS实例规格。所有PolarDB节点均为独享型，性能稳定可靠。详情请参见[规格与定价](/intl.zh-CN/产品定价/规格与定价.md)。|
    |**节点个数**|无需选择。系统将自动创建一个与主节点规格相同的只读节点。|
    |**存储费用**|无需选择。系统会根据实际数据使用量按小时计费，详情请参见[产品价格](/intl.zh-CN/产品定价/规格与定价.md)。 **说明：** 创建集群时无需选择存储容量，存储容量随数据量的增减而自动弹性伸缩。 |
    |**时区**|设置集群时区，默认时区为**UTC+08:00**。|
    |**表名大小写**|设置集群表名是否区分大小写，默认**不区分大小写**。当本地数据库区分大小时，您可以选择区分大小写，便于您迁移数据。**说明：** 集群创建后该参数无法修改，请谨慎选择。 |
    |**删除（释放）集群时**|设置删除（释放）集群时的备份保留策略，默认**保留最后一个备份（释放前自动备份）**。    -   **保留最后一个备份（释放前自动备份）**：删除集群时保留最后一个备份。
    -   **保留全部备份**：删除集群时保留所有备份。
    -   **不保留备份（释放后无法恢复）**：删除集群时不保留任何备份。
**说明：** 删除（释放）集群时保留备份可能会产生少量费用，您可以随时删除备份来节省成本，详情请参见[数据备份价格（超出免费额度时）](/intl.zh-CN/产品定价/规格与定价.mdsection_ryg_gsw_hmu)。 |
    |**集群名称**|    -   集群名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、英文句号（.）、下划线（\_）或短划线（-）。
    -   如果留空，系统将为您自动生成一个集群名称。创建集群后还可以修改集群名称。 |
    |**资源组**|从已[创建资源组]()中选择一个目标资源组。**说明：** 资源组是在单个云账号下将一组相关资源进行统一管理的容器，一个资源只能归属于一个资源组，详情请参见[RAM资源分组与授权](/intl.zh-CN/教程/RAM资源分组与授权.md)。 |

6.  设置**购买时长**（仅针对**包年包月**集群）和**集群数量**后，单击右侧的**立即购买**。

7.  在**确认订单**页面确认订单信息，阅读并选中服务协议，单击**去支付**。

8.  在**支付**页面，确认未支付订单信息和支付方式，单击**支付**。

9.  登录[PolarDB控制台](https://polardb.console.aliyun.com)，查看新建的PolarDB集群的状态。

    **说明：**

    -   集群创建后开始从RDS实例同步数据，您需要在7天内进行[完成迁移](#section_3ds_ojf_lmm)操作，超过7天将自动关闭迁移功能。
    -   您可以在此步骤选择取消迁移，相关影响请参见[迁移常见问题](#section_lxr_3fp_13b)。

## 步骤二：迁移切换

在迁移切换前，需先满足如下条件：

-   已完成[步骤一：从RDS迁移](#section_s4t_zsn_13b)的操作。
-   **复制延迟**小于60秒。

    ![基本信息](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6003729951/p51400.png)


1.  进入[PolarDB控制台](https://polardb.console.aliyun.com)。

2.  找到目标集群，单击集群的ID。

3.  在**基本信息**页面单击**迁移切换**，在弹出的对话框中单击**确定**。

    ![迁移切换](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6003729951/p51031.png)

    **说明：** 切换过程一般小于5分钟。

    本操作将交换源RDS实例和目标PolarDB集群的读写状态（即将源RDS实例修改为只读，将PolarDB集群修改为可读可写），同时会更换复制方向（即将PolarDB集群的新增数据同步到RDS实例）。

4.  在**开始切换**对话框中，选择**带地址切换（应用程序不用改连接配置）**或**不带地址切换（应用程序需要改为新的PolarDB连接配置）**。

    ![开始切换](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6003729951/p120880.png)

    若您选择**带地址切换（应用程序不用改连接配置）**，操作步骤如下：

    1.  选中**带地址切换（应用程序不用改连接配置）**，系统会自动交换RDS和PolarDB上的连接地址，您无需在应用程序端修改任何配置即可自动连接到PolarDB。选择该切换方式后，RDS连接地址对应的PolarDB连接地址如下图所示。

        ![地址交换规则](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6003729951/p120873.png)

        **说明：**

        -   带地址切换只会切换RDS和PolarDB的域名，Vswitch、Vip等配置不会切换。
        -   仅当源RDS和目标PolarDB集群同时存在的连接地址才支持相互切换，默认情况下仅私网主地址支持带地址切换。
        -   如需切换其他连接地址，您需在切换前创建好对应的连接地址，否则不会切换。关于如何为PolarDB集群和RDS实例创建连接地址，请参见[新增自定义集群地址](/intl.zh-CN/用户指南/集群访问/集群地址/新增自定义集群地址.md)和[设置连接地址]()。
        -   带地址切换不会切换端口，请确保RDS和PolarDB的连接端口一致，修改RDS端口请参见[查看或修改内外网地址和端口](/intl.zh-CN/RDS MySQL 数据库/数据库连接/查看或修改内外网地址和端口.md)，修改PolarDB端口请参见[修改连接地址和端口](/intl.zh-CN/用户指南/集群访问/修改或释放连接地址.md)。
        -   切换域名后，可能会存在DNS解析缓存问题，在缓存过期时间内可能会出现连接不上数据库或数据库只支持读操作无法执行写入操作等情况，建议您刷新一下服务器的DNS缓存。
        -   切换域名后，如果您需要使用DMS登录PolarDB数据库，必须使用新版本的DMS并且使用集群ID来进行登录，连接串无法登录。
    2.  单击**确定**。

        **说明：** 迁移切换完成后，如果您发现数据存在异常等问题，可以进行回滚操作，快速恢复至迁移前的状态也可以选择[迁移回滚](#section_hw4_hy4_13b)。

    若您选择**不带地址切换（应用程序需要改为新的PolarDB连接配置）**，操作步骤如下：

    1.  选中**不带地址切换（应用程序需要改为新的PolarDB连接配置）**，在迁移切换完成后，您需要尽快修改应用程序端的数据库连接地址。

    2.  单击**确定**。

    3.  刷新页面，当**PolarDB读写状态**显示为**读写**后，尽快修改应用里的数据库连接地址。

        ![刷新](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6003729951/p51038.png)

        **说明：** 迁移切换完成后，如果您发现数据存在异常等问题，可以进行回滚操作，快速恢复至迁移前的状态也可以选择[迁移回滚](#section_hw4_hy4_13b)。


## 步骤三：完成迁移

[从RDS迁移](#section_s4t_zsn_13b)后，您需要在7天内进行**完成迁移**操作。

**警告：** 由于本操作将中断PolarDB集群和RDS实例间的数据同步，不再提供[迁移回滚](#section_hw4_hy4_13b)功能，建议您使用一段时间PolarDB集群，确认正常后再执行本操作。

1.  登录[PolarDB控制台](https://polardb.console.aliyun.com)。

2.  找到目标集群，单击集群的ID。

3.  在**基本信息**页面，单击**完成迁移**，在弹出的对话框中单击**确定**。

    ![完成迁移](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6003729951/p48987.png)

    ![完成迁移确定](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7003729951/p51039.png)

    **说明：**

    -   单击**确定**后，系统将在约2分钟内中断同步关系，期间**完成迁移**按钮不会消失，请勿重复单击。
    -   您可以选择是否关闭PolarDB集群的Binlog。关闭Binlog会带来少量的写入性能提升，但需要重启PolarDB。
    -   如果不再需要源RDS实例，可以释放实例，详情请参见[释放实例](/intl.zh-CN/RDS MySQL 数据库/实例生命周期/释放实例.md)。

## 迁移回滚

在完成迁移前，如果您发现数据存在异常等问题，可以进行回滚操作，快速恢复至迁移前的状态（RDS实例为可读可写，PolarDB集群为只读，同时会将RDS实例的数据同步到PolarDB集群）。

1.  登录[PolarDB控制台](https://polardb.console.aliyun.com)。

2.  找到目标集群，单击集群ID。

3.  在**基本信息**页面单击**迁移回滚**。

    ![迁移回滚](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7003729951/p48988.png)

4.  在**开始回切**对话框中，选择**带地址回切（应用程序不用改连接配置）**或**不带地址回切（应用程序需要改为原RDS连接配置）**。

    ![1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7003729951/p131920.png)

    若您选择**带地址回切（应用程序不用改连接配置）**，操作步骤如下：

    1.  选中**带地址回切（应用程序不用改连接配置）**，系统会自动交换RDS和PolarDB上的连接地址，您无需在应用程序端修改任何配置即可自动回切到RDS。

        **说明：**

        -   带地址切换只会切换RDS和PolarDB的域名，Vswitch、Vip等配置不会切换。
        -   带地址切换不会切换端口，请确保RDS和PolarDB的连接端口一致，修改RDS端口请参见[查看或修改内外网地址和端口](/intl.zh-CN/RDS MySQL 数据库/数据库连接/查看或修改内外网地址和端口.md)，修改PolarDB端口请参见[修改连接地址和端口](/intl.zh-CN/用户指南/集群访问/修改或释放连接地址.md)。
        -   切换域名后，可能会存在DNS解析缓存问题，在缓存过期时间内可能会出现连接不上数据库或数据库只支持读操作无法执行写入操作等情况，建议您刷新一下服务器的DNS缓存。
    2.  单击**确定**。

        **说明：** 单击**确定**后RDS实例为可读可写，PolarDB集群为只读，同时会将RDS实例的数据同步到PolarDB集群。

    若您选择**不带地址回切（应用程序需要改为原RDS连接配置）**，操作步骤如下：

    1.  选中**不带地址回切（应用程序需要改为原RDS连接配置）**，在迁移切换完成后，您需要尽快修改应用程序端的数据库连接地址。

    2.  单击**确定**。

        **说明：** 单击**确定**后RDS实例为可读可写，PolarDB集群为只读，同时会将RDS实例的数据同步到PolarDB集群。

    3.  刷新页面，当**源RDS读写状态**显示为**读写**后，请尽快修改应用里的数据库连接地址为RDS连接地址。


## 迁移常见问题

-   从RDS迁移会影响源RDS实例吗？

    答：不会影响源RDS实例的正常运行。

-   平滑迁移对业务有影响吗？

    答：平滑迁移能够保证迁移过程不丢失数据，停机时间小于10分钟，如果有需要还可以进行回滚。

-   取消迁移会有什么影响？

    答：取消迁移后，源RDS实例可以修改参数；PolarDB集群恢复可读可写，且数据不会释放。手动取消时可以选择是否关闭PolarDB集群的Binlog，自动取消时不会关闭。


## 相关API

|API|描述|
|---|--|
|[CreateDBCluster](/intl.zh-CN/API参考/集群管理/CreateDBCluster.md)|创建PolarDB集群。 **说明：** 一键升级时，参数CreationOption取值需要为MigrationFromRDS。 |
|[DescribeDBClusterMigration](/intl.zh-CN/API参考/从RDS迁移/DescribeDBClusterMigration.md)|查询PolarDB集群的迁移状态。|
|[ModifyDBClusterMigration](/intl.zh-CN/API参考/从RDS迁移/ModifyDBClusterMigration.md)|修改迁移任务，进行任务的切换或回滚。|
|[CloseDBClusterMigration](/intl.zh-CN/API参考/从RDS迁移/CloseDBClusterMigration.md)|取消或完成迁移。|

